<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (X11; I; Linux 2.4.0-test6 i586) [Netscape]">
   <title>TI-89 Link Protocol Guide - Packet formats</title>
</head>
<body bgcolor="#FFFFE8">
<b>TI-89 Link Protocol Guide</b> - Packet formats 
<center>
<h2>

<hr ALIGN="CENTER">Packet Formats</h2></center>
Texas Instruments calculators always send data and responses in self-contained
"packets."
<br>Packets have the following format:
<br><i>Note - all 2-byte integers are transmitted little-endian Intel-style
(least significant byte first).</i>
<table BORDER CELLSPACING=0 WIDTH="92%" >
<tr>
<th WIDTH="7%" BGCOLOR="#008800"><font color="#FFFFFF">Offset</font></th>

<th WIDTH="8%" BGCOLOR="#008800"><font color="#FFFFFF">Length</font></th>

<th WIDTH="85%" BGCOLOR="#008800"><font color="#FFFFFF">Description</font></th>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">0</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">1 byte</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Machine ID byte</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">1</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">1 byte</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Command ID byte</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">2</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">2 bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Length of data (see note below)</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">4</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF"><i>n</i> bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Data (if attached)</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">4+<i>n</i></td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">2 bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Checksum (if data is attached)</td>
</tr>
</table>
<i>Note - The "Length of data" element may not be equal to zero if the
packet contains no data. In this case, the Command ID byte will indicate
that the packet contains no data.</i>
<h4>
The Machine ID Byte</h4>
The Machine ID byte identifies the machine that is sending the packet.
It can have one of the following values:
<table BORDER CELLSPACING=0 WIDTH="66%" >
  <tr> 
    <th WIDTH="13%" BGCOLOR="#DDDDDD">Value</th>
    <th BGCOLOR="#DDDDDD">Description</th>
  </tr>
  <tr> 
    <td WIDTH="13%">08h</td>
    <td>Computer sending TI-89/92+/V200 data</td>
  </tr>
  <tr> 
    <td WIDTH="13%">88h</td>
    <td>TI-92+/V200 to Computer or TI-92+/V200 to TI-92+/V200</td>
  </tr>
  <tr> 
    <td width="13%">98h</td>
    <td>TI-89 to Computer or TI89 to TI89</td>
  </tr>
</table>

<h4>
The Command ID Byte</h4>
The Command ID byte identifies the request or response that the machine
is sending. It can have one of the following values:
<table BORDER CELLSPACING=0 WIDTH="66%" >
<tr>
<th WIDTH="22%" BGCOLOR="#DDDDDD">Value</th>

<th WIDTH="259" BGCOLOR="#DDDDDD">Description</th>

<th BGCOLOR="#DDDDDD">Data Included</th>
</tr>

<tr>
<td WIDTH="22%">06h</td>

<td WIDTH="259">Variable Header (VAR)</td>

<td>A standard or padded <a href="#varheader">variable header</a></td>
</tr>

<tr>
<td WIDTH="22%">09h</td>

<td WIDTH="259">Clear to send (CTS)</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">15h</td>

<td WIDTH="259">Data packet (DATA)</td>

<td>Screenshot/variable/backup data</td>
</tr>

<tr>
<td WIDTH="22%">36h</td>

<td WIDTH="259">Out of Memory (MEM)</td>

<td>Five bytes of unknown data</td>
</tr>

<tr>
<td WIDTH="22%">56h</td>

<td WIDTH="259">Acknowledge (ACK)</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">5Ah</td>

<td WIDTH="259">Checksum Error (ERR)&nbsp;
<br>The previous packet must be sent again.</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">68h</td>

<td WIDTH="259">Check Ready (RDY)</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">6Dh</td>

<td WIDTH="259"><i>Silent</i> - Request Screenshot (SCR)</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">78h</td>

<td WIDTH="259">Continue (CONT)</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">87h</td>

<td WIDTH="259">Direct command (CMD)</td>

<td><i>None - all data needed is in the packet header. There is no checksum.</i></td>
</tr>

<tr>
<td WIDTH="22%">92h</td>

<td WIDTH="259">End of Transmission (EOT)</td>

<td><i>None</i></td>
</tr>

<tr>
<td WIDTH="22%">A2h</td>

<td WIDTH="259"><i>Silent</i> - Request Variable (REQ)</td>

<td>A standard or padded <a href="#varheader">variable header</a></td>
</tr>

<tr>
<td WIDTH="22%">C9h</td>

<td WIDTH="259"><i>Silent</i> - Request to Send Variable (RTS)</td>

<td>A standard or padded <a href="#varheader">variable header</a></td>
</tr>
</table>

<h4>
The Checksum</h4>
The checksum is a 16-bit value used to verify the integrity of the data
in the packet. It only present if data is present.
<br>The checksum is calculated by taking the lower 16 bits of the sum of
the data bytes, as shown below:
<pre>int calculateChecksum(unsigned char* data, unsigned short datalength) {
&nbsp;&nbsp; unsigned short x, checksum;
&nbsp;&nbsp; for(x=0; x&lt;datalength; x++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; checksum+=data[x];&nbsp; //overflow automatically limits to 16 bits
&nbsp;&nbsp; }
&nbsp;&nbsp; return checksum;
}</pre>

<center>
<h3>

<hr ALIGN="CENTER"><a NAME="varheader"></a>Variable Headers</h3></center>
A Variable header contains information about one variable in the calculator.
<table BORDER CELLSPACING=0 WIDTH="92%" >
<tr>
<th WIDTH="7%" BGCOLOR="#008800"><font color="#FFFFFF">Offset</font></th>

<th WIDTH="8%" BGCOLOR="#008800"><font color="#FFFFFF">Length</font></th>

<th WIDTH="85%" BGCOLOR="#008800"><font color="#FFFFFF">Description</font></th>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">0</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">4 bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Size of actual variable data, in bytes,
with or without the first four bytes of each data packet.</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">4</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">1 byte</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Type ID Byte (see type ID's below)</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">5</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">1 byte</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Size of variable name, in characters</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">6</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF"><i>n</i> bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Variable name (not zero-terminated)</td>
</tr>
</table>
<i>Note: These bytes only make up the "data" section of the packet.</i>
<h4>
<a NAME="vartypes"></a>The Type ID Byte</h4>
The type ID byte specifies the type of variable that is being transmitted.
It can have one of the following values:
<table BORDER CELLSPACING=0 WIDTH="66%" >
  <tr> 
    <th WIDTH="13%" BGCOLOR="#DDDDDD">Value</th>
    <th BGCOLOR="#DDDDDD">Description (click for variable format)</th>
  </tr>
  <tr> 
    <td WIDTH="13%">00h</td>
    <td><a href="vars.html#expr">Expression</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">04h</td>
    <td><a href="vars.html#list">List</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">06h</td>
    <td><a href="vars.html#matrix">Matrix</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">0Ah</td>
    <td><a href="vars.html#data">Data</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">0Bh</td>
    <td><a href="vars.html#text">Text</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">0Ch</td>
    <td><a href="vars.html#string">String</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">0Dh</td>
    <td><a href="vars.html#gdb">GDB</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">0Eh</td>
    <td><a href="vars.html#figure">Figure</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">10h</td>
    <td><a href="vars.html#gdb">Picture</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">12h</td>
    <td><a href="vars.html#program">Program</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">13h</td>
    <td><a href="vars.html#program">Function</a></td>
  </tr>
  <tr> 
    <td WIDTH="13%">14h</td>
    <td><a href="vars.html#program">Macro</a></td>
  </tr>
  <tr>
    <td WIDTH="13%">18h</td>
    <td>Set/Get calculator date</td>
  </tr>
  <tr> 
    <td WIDTH="13%">1Ah</td>
    <td>Directory (directory list request)</td>
  </tr>
  <tr> 
    <td WIDTH="13%">1Bh</td>
    <td>Local directory</td>
  </tr>
  <tr> 
    <td WIDTH="13%">1Dh</td>
    <td><a href="backup.html">Backup</a> <i>(See Backup Header Format below) (used 
      only in sending mode)</i></td>
  </tr>
  <tr> 
    <td WIDTH="13%">1Fh</td>
    <td>Folder - only used when listing a directory.</td>
  </tr>
  <tr> 
    <td WIDTH="13%">21h</td>
    <td>Assembler</td>
  </tr>
  <tr> 
    <td WIDTH="13%">22h</td>
    <td>Get IDLIST</td>
  </tr>
  <tr> 
    <td WIDTH="13%">23h</td>
    <td>Advanced Mathematic Software: the Operating System of the calculator (AMS)</td>
  </tr>
  <tr> 
    <td WIDTH="13%">24h</td>
    <td>FLASH application (free apps, at least)</td>
  </tr>
</table>
<i>Note - If the Type ID is 1Ah, 1Bh or 22h, then the name length byte
has a value of 0 and the name field is empty.</i> Moreover, the upper byte
of the length field (offset 0) is a byte used for filtering file types.
<h4>
<a NAME="backup"></a>Backup Header Format (in sending only)</h4>
If the type ID byte specifies a backup, the variable header takes the following
format:
<table BORDER CELLSPACING=0 WIDTH="92%" >
<tr>
<th WIDTH="7%" BGCOLOR="#008800"><font color="#FFFFFF">Offset</font></th>

<th WIDTH="8%" BGCOLOR="#008800"><font color="#FFFFFF">Length</font></th>

<th WIDTH="85%" BGCOLOR="#008800"><font color="#FFFFFF">Description</font></th>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">0</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">4 bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Always {00h, 00h, 00h, 00h}.</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">3</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">1 byte</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Type ID Byte (1Dh in this case).</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">4</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">1 bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Length, in characters, of the name field.
Always 04h.</td>
</tr>

<tr>
<td WIDTH="7%" BGCOLOR="#FFFFFF">5</td>

<td WIDTH="8%" BGCOLOR="#FFFFFF">n bytes</td>

<td WIDTH="85%" BGCOLOR="#FFFFFF">Name: "main".</td>
</tr>
</table>

<p>If the header is a request-style header, then the data length field
(offset 0) contains 4 and the name field (offset 5) contains "main".
<p>A remark: the backup request is only used in sending mode. Indeed, the
TI89 (and also the TI92+) does not have a true backup mode. A backup is
simply a group of all variables.
<br>&nbsp;
<br>&nbsp;
<table BORDER=0 CELLSPACING=0 WIDTH="100%" >
<tr>
<td WIDTH="32%">
<center><a href="cable.html"><img SRC="graphics/prevpage.gif" ALT="[previous page]" BORDER=2 height=32 width=32 align=BOTTOM></a>
<br><a href="cable.html">Link Cables</a></center>
</td>

<td WIDTH="34%">
<center><a href="index.html"><img SRC="graphics/home.gif" ALT="[home]" BORDER=2 height=32 width=32 align=BOTTOM></a>
<br><a href="index.html">Table of Contents</a></center>
</td>

<td WIDTH="34%">
<center><a href="remote.html"><img SRC="graphics/nextpage.gif" ALT="[next page]" BORDER=2 height=32 width=32 align=BOTTOM></a>
<br><a href="remote.html">Remote control</a></center>
</td>
</tr>
</table>

<hr ALIGN="CENTER"><i>Site maintained by Romain Li&eacute;vin (<a href="mailto:roms@lpg.ticalc.org">roms@lpg.ticalc.org</a>)
and Tim Singer (<a href="mailto:tsinger@gladstone.uoregon.edu">tsinger@gladstone.uoregon.edu</a>)</i>
</body>
</html>
